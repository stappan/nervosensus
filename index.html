<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensory Neuron Cell Type Explorer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f7fa; }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
        h1 { color: #2d3748; margin-bottom: 0.5rem; }
        .subtitle { color: #718096; margin-bottom: 1.5rem; }
        .header-row { display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem; }
        .upload-section { display: flex; align-items: center; gap: 0.75rem; }
        .upload-btn { padding: 0.5rem 1rem; background: linear-gradient(135deg, #48bb78, #38a169); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 0.85rem; }
        #fileInput { display: none; }
        .data-status { padding: 0.4rem 0.8rem; background: #edf2f7; border-radius: 6px; font-size: 0.8rem; color: #4a5568; }
        .data-status.loaded { background: #c6f6d5; color: #276749; }
        .view-buttons { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
        .view-btn { padding: 0.75rem 1.5rem; background: white; color: #4a5568; border: 2px solid #e2e8f0; border-radius: 8px; font-weight: 600; cursor: pointer; }
        .view-btn:hover { border-color: #667eea; color: #667eea; }
        .view-btn.active { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-color: transparent; }
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem; }
        .card { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #667eea; cursor: pointer; transition: all 0.2s; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .card-header { padding: 1rem; background: #667eea15; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: flex-start; }
        .card-title { font-weight: 700; color: #2d3748; font-size: 1.1rem; }
        .card-source-link { font-size: 0.75rem; color: #667eea; text-decoration: none; white-space: nowrap; }
        .card-source-link:hover { text-decoration: underline; }
        .card-body { padding: 1.25rem; }
        .card-entity { color: #718096; font-size: 0.9rem; margin-bottom: 1rem; }
        .card-section { margin-top: 1rem; }
        .section-title { font-weight: 600; color: #4a5568; font-size: 0.85rem; margin-bottom: 0.5rem; }
        .gene-display { padding: 1rem; background: linear-gradient(135deg, #667eea15, #764ba215); border: 2px solid #667eea40; border-radius: 10px; font-size: 0.95rem; font-weight: 700; color: #2d3748; line-height: 1.6; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal.show { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: white; border-radius: 16px; max-width: 800px; max-height: 90vh; overflow-y: auto; width: 90%; position: relative; }
        .modal-header { padding: 1.5rem; border-bottom: 2px solid #e2e8f0; }
        .modal-header h2 { color: #2d3748; }
        .modal-body { padding: 2rem; }
        .detail-section { margin-bottom: 2rem; }
        .detail-section h3 { color: #4a5568; margin-bottom: 1rem; font-size: 1.1rem; }
        .gene-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 0.5rem; }
        .gene-link { display: inline-block; padding: 0.5rem 1rem; background: #edf2f7; border-radius: 6px; text-decoration: none; color: #2d3748; font-weight: 600; font-size: 0.9rem; }
        .gene-link:hover { background: #667eea; color: white; }
        .close-btn { position: absolute; top: 1rem; right: 1rem; background: none; border: none; font-size: 2rem; cursor: pointer; color: #718096; }
        .source-link { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.25rem; background: linear-gradient(135deg, #667eea, #764ba2); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 0.9rem; transition: all 0.2s; }
        .source-link:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
        .tree-container { padding: 2rem; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .tree-soma-group { margin-bottom: 1.5rem; }
        .tree-soma-header { padding: 1rem 1.25rem; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 10px; cursor: pointer; display: flex; align-items: center; gap: 0.75rem; }
        .tree-soma-icon { font-size: 1.25rem; }
        .tree-soma-name { font-weight: 700; font-size: 1.1rem; flex: 1; }
        .tree-soma-count { font-size: 0.85rem; opacity: 0.9; }
        .tree-soma-toggle { transition: transform 0.2s; }
        .tree-soma-toggle.expanded { transform: rotate(90deg); }
        .tree-soma-children { padding-left: 1.5rem; margin-top: 0.75rem; max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
        .tree-soma-children.expanded { max-height: 5000px; }
        .tree-item { margin: 0.75rem 0; }
        .tree-master { padding: 1rem; background: linear-gradient(135deg, #667eea15, #764ba215); border-left: 4px solid #667eea; border-radius: 8px; cursor: pointer; }
        .tree-master-name { font-weight: 700; font-size: 1.05rem; color: #2d3748; }
        .tree-master-count { font-size: 0.85rem; color: #718096; margin-top: 0.25rem; }
        .tree-children { padding-left: 2rem; margin-top: 0.5rem; max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
        .tree-children.expanded { max-height: 1000px; }
        .tree-child { padding: 0.75rem 1rem; margin: 0.5rem 0; background: #f7fafc; border-left: 3px solid #e2e8f0; border-radius: 6px; cursor: pointer; }
        .tree-child:hover { background: #edf2f7; border-left-color: #667eea; }
        .tree-child-name { font-weight: 600; color: #4a5568; }
        .tree-child-species { font-size: 0.85rem; color: #718096; margin-top: 0.25rem; }
        .tree-toggle { display: inline-block; width: 20px; text-align: center; margin-right: 0.5rem; transition: transform 0.2s; }
        .tree-toggle.expanded { transform: rotate(90deg); }
        .cluster-container { display: flex; flex-direction: column; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden; }
        .cluster-top-bar { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #667eea15, #764ba215); border-bottom: 1px solid #e2e8f0; flex-wrap: wrap; gap: 1rem; }
        .cluster-stats-inline { display: flex; gap: 1.5rem; flex-wrap: wrap; }
        .stat-item { display: flex; align-items: center; gap: 0.4rem; font-size: 0.85rem; }
        .stat-item .stat-label { color: #718096; }
        .stat-item .stat-value { font-weight: 700; color: #667eea; }
        .cluster-legend-inline { display: flex; gap: 1rem; flex-wrap: wrap; }
        .legend-item-inline { display: flex; align-items: center; gap: 0.3rem; font-size: 0.8rem; color: #4a5568; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; border: 1px solid rgba(0,0,0,0.1); }
        .cluster-main { display: flex; flex: 1; min-height: 600px; }
        .cluster-controls { width: 240px; min-width: 240px; padding: 1rem; background: #f8fafc; border-right: 1px solid #e2e8f0; overflow-y: auto; flex-shrink: 0; }
        .cluster-controls h3 { font-size: 0.9rem; color: #2d3748; margin-bottom: 0.75rem; }
        .attr-group { margin-bottom: 1rem; }
        .attr-group-title { font-size: 0.7rem; color: #718096; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.4rem; }
        .attr-btn { display: inline-block; padding: 0.35rem 0.5rem; margin: 0.15rem; background: white; border: 1px solid #e2e8f0; border-radius: 12px; color: #4a5568; font-size: 0.7rem; cursor: pointer; }
        .attr-btn:hover { border-color: #667eea; color: #667eea; }
        .attr-btn.active { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-color: transparent; }
        .attr-btn.active.attr-2 { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .attr-btn.active.attr-3 { background: linear-gradient(135deg, #22c55e, #16a34a); }
        .cluster-viz-area { flex: 1; position: relative; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-width: 0; }
        #clusterSvg { width: 100%; height: 100%; display: block; }
        .cluster-node { cursor: pointer; }
        .cluster-node:hover { filter: brightness(1.2); }
        .cluster-enclosure { fill: none; stroke-width: 2; stroke-dasharray: 6, 3; opacity: 0.5; }
        .cluster-label { font-size: 11px; font-weight: 600; fill: rgba(255,255,255,0.95); text-anchor: middle; }
        .cluster-label-bg { fill: rgba(0,0,0,0.7); rx: 4; ry: 4; }
        .cluster-tooltip { position: absolute; background: rgba(255,255,255,0.95); border-radius: 8px; padding: 0.75rem; max-width: 250px; pointer-events: none; opacity: 0; transition: opacity 0.2s; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 100; }
        .cluster-tooltip.visible { opacity: 1; }
        .cluster-tooltip-title { font-weight: 700; color: #2d3748; margin-bottom: 0.25rem; }
        .cluster-tooltip-row { font-size: 0.8rem; color: #4a5568; }
        .cluster-instructions { position: absolute; bottom: 0.75rem; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.5); color: white; padding: 0.4rem 0.8rem; border-radius: 16px; font-size: 0.75rem; }
        .upload-modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1001; align-items: center; justify-content: center; }
        .upload-modal.show { display: flex; }
        .upload-modal-content { background: white; border-radius: 16px; max-width: 600px; width: 90%; padding: 2rem; }
        .upload-modal-content h2 { margin-bottom: 1rem; color: #2d3748; }
        .upload-drop-zone { border: 3px dashed #e2e8f0; border-radius: 12px; padding: 3rem; text-align: center; margin: 1.5rem 0; cursor: pointer; }
        .upload-drop-zone:hover, .upload-drop-zone.dragover { border-color: #667eea; background: #667eea10; }
        .upload-drop-zone p { color: #718096; margin-bottom: 0.5rem; }
        .format-info { background: #f7fafc; border-radius: 8px; padding: 1rem; margin-top: 1rem; }
        .format-info h4 { font-size: 0.9rem; color: #4a5568; margin-bottom: 0.5rem; }
        .format-info p { font-size: 0.8rem; color: #718096; margin: 0.25rem 0; }
        .format-info code { background: #edf2f7; padding: 0.1rem 0.3rem; border-radius: 3px; font-size: 0.75rem; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-row">
            <div>
                <h1>üß¨ Sensory Neuron Cell Type Explorer</h1>
                <p class="subtitle">Exploring DRG & Trigeminal ganglion sensory neuron types</p>
            </div>
            <div class="upload-section">
                <button class="upload-btn" onclick="showUploadModal()">üìÅ Load Data</button>
                <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" onchange="handleFileSelect(event)">
                <span class="data-status" id="dataStatus">Default data (54 cells)</span>
            </div>
        </div>
        <div class="view-buttons">
            <button class="view-btn active" data-view="cards">üìã Card View</button>
            <button class="view-btn" data-view="tree">üå≥ Tree View</button>
            <button class="view-btn" data-view="cluster">üîÆ Cluster View</button>
        </div>
        <div id="cardViewContainer"><div class="cards-grid" id="cardsContainer"></div></div>
        <div id="treeViewContainer" style="display: none;"><div class="tree-container"><h2 style="margin-bottom: 1.5rem; color: #2d3748;">Cell Type Hierarchy</h2><div id="treeView"></div></div></div>
        <div id="clusterViewContainer" style="display: none;">
            <div class="cluster-container">
                <div class="cluster-top-bar">
                    <div class="cluster-stats-inline" id="clusterStatsInline"><div class="stat-item"><span class="stat-label">Total:</span><span class="stat-value" id="statTotal">54</span></div></div>
                    <div class="cluster-legend-inline" id="clusterLegendInline"><div class="legend-item-inline"><div class="legend-dot" style="background: #667eea;"></div><span>Select attributes to cluster</span></div></div>
                </div>
                <div class="cluster-main">
                    <div class="cluster-controls">
                        <h3>Select Attributes (up to 3)</h3>
                        <div class="attr-group"><div class="attr-group-title">Threshold Phenotype</div>
                            <button class="attr-btn" data-attr="cold_sensitive">Cold</button>
                            <button class="attr-btn" data-attr="heat_sensitive">Heat</button>
                            <button class="attr-btn" data-attr="mechanosensitive_ltm">LTM</button>
                            <button class="attr-btn" data-attr="mechanosensitive_htm">HTM</button>
                            <button class="attr-btn" data-attr="proprioceptive">Proprioceptive</button>
                        </div>
                        <div class="attr-group"><div class="attr-group-title">Adaptation Phenotype</div>
                            <button class="attr-btn" data-attr="rapidly_adapting">RA</button>
                            <button class="attr-btn" data-attr="slowly_adapting">SA</button>
                        </div>
                        <div class="attr-group"><div class="attr-group-title">Axon Phenotype</div>
                            <button class="attr-btn" data-attr="fiber_a_beta">AŒ≤</button>
                            <button class="attr-btn" data-attr="fiber_a_delta">AŒ¥</button>
                            <button class="attr-btn" data-attr="fiber_c">C</button>
                        </div>
                        <div class="attr-group"><div class="attr-group-title">Species</div>
                            <button class="attr-btn" data-attr="species_mouse">Mouse</button>
                            <button class="attr-btn" data-attr="species_human">Human</button>
                            <button class="attr-btn" data-attr="species_macaque">Macaque</button>
                            <button class="attr-btn" data-attr="species_guinea_pig">Guinea Pig</button>
                        </div>
                        <div class="attr-group"><div class="attr-group-title">Soma Location</div>
                            <button class="attr-btn" data-attr="soma_drg">DRG</button>
                            <button class="attr-btn" data-attr="soma_tg">Trigeminal</button>
                        </div>
                    </div>
                    <div class="cluster-viz-area">
                        <svg id="clusterSvg"></svg>
                        <div class="cluster-tooltip" id="clusterTooltip"></div>
                        <div class="cluster-instructions">Click nodes for details ‚Ä¢ Drag to reposition</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" id="modal"><div class="modal-content"><button class="close-btn" onclick="closeModal()">√ó</button><div class="modal-header"><h2 id="modalTitle"></h2></div><div class="modal-body" id="modalBody"></div></div></div>
    <div class="upload-modal" id="uploadModal">
        <div class="upload-modal-content">
            <h2>üìÅ Load Cell Type Data</h2>
            <p style="color: #718096;">Upload a CSV or Excel file with your cell type data.</p>
            <div class="upload-drop-zone" id="dropZone" onclick="document.getElementById('fileInput').click()"><p>üìÑ Drag & drop your file here</p><p>or click to browse</p><p class="formats" style="font-size:0.85rem;color:#a0aec0;">Supported: .csv, .xlsx, .xls</p></div>
            <div class="format-info"><h4>Supported Format: NPO Template (Row-based)</h4><p>Columns: <code>Neuron ID</code>, <code>NPO Property</code>, <code>Union set number</code>, <code>nest intersection number</code>, <code>Property Value Label</code></p></div>
            <div style="margin-top: 1.5rem; display: flex; gap: 1rem; justify-content: flex-end;">
                <button onclick="closeUploadModal()" style="padding: 0.5rem 1rem; background: #edf2f7; border: none; border-radius: 6px; cursor: pointer;">Cancel</button>
                <button onclick="loadDefaultData()" style="padding: 0.5rem 1rem; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">Reset to Default</button>
            </div>
        </div>
    </div>
    <script>
        const DEFAULT_FAMILIES = [{"id":"1","name":"Pvalb","children":["Pvalb guinea pig neuron","Pvalb human neuron","Pvalb macaque neuron","Pvalb mouse neuron"]},{"id":"2","name":"Ntrk3^high+S100a16","children":["Ntrk3^high+S100a16 guinea pig neuron","Ntrk3^high+S100a16 human neuron","Ntrk3^high+S100a16 macaque neuron","Ntrk3^high+S100a16 mouse neuron"]},{"id":"3","name":"Ntrk3^high+Ntrk2","children":["Ntrk3^high+Ntrk2 human neuron","Ntrk3^high+Ntrk2 macaque neuron","Ntrk3^high+Ntrk2 mouse neuron"]},{"id":"4","name":"Ntrk3^low+Ntrk2","children":["Ntrk3^low+Ntrk2 guinea pig neuron","Ntrk3^low+Ntrk2 human neuron","Ntrk3^low+Ntrk2 macaque neuron","Ntrk3^low+Ntrk2 mouse neuron"]},{"id":"5","name":"Calca+Smr2","children":["Calca+Smr2 guinea pig neuron","Calca+Smr2 human neuron","Calca+Smr2 macaque neuron","Calca+Smr2 mouse neuron"]},{"id":"6","name":"Calca+Bmpr1b","children":["Calca+Bmpr1b guinea pig neuron","Calca+Bmpr1b human neuron","Calca+Bmpr1b macaque neuron","Calca+Bmpr1b mouse neuron"]},{"id":"7","name":"Th","children":["Th guinea pig neuron","Th human neuron","Th macaque neuron","Th mouse neuron"]},{"id":"8","name":"Mrgprd","children":["Mrgprd guinea pig neuron","Mrgprd human neuron","Mrgprd macaque neuron","Mrgprd mouse neuron"]},{"id":"9","name":"Mrgpra3+Trpv1","children":["Mrgpra3+Trpv1 mouse neuron"]},{"id":"10","name":"Mrgpra3+Mrgprb4","children":["Mrgpra3+Mrgprb4 mouse neuron"]},{"id":"11","name":"Calca+Sstr2","children":["Calca+Sstr2 human neuron","Calca+Sstr2 macaque neuron","Calca+Sstr2 mouse neuron"]},{"id":"12","name":"Calca+Oprk1","children":["Calca+Oprk1 mouse neuron"]},{"id":"13","name":"Calca+Adra2a","children":["Calca+Adra2a human neuron","Calca+Adra2a mouse neuron"]},{"id":"14","name":"Calca+Dcn","children":["Calca+Dcn mouse neuron"]},{"id":"15","name":"Rxfp1","children":["Rxfp1 macaque neuron","Rxfp1 mouse neuron"]},{"id":"16","name":"Trpm8","children":["Trpm8 guinea pig neuron","Trpm8 human neuron","Trpm8 macaque neuron","Trpm8 mouse neuron"]},{"id":"17","name":"Sst","children":["Sst guinea pig neuron","Sst human neuron","Sst macaque neuron","Sst mouse neuron"]},{"id":"18","name":"Atf3","children":["Atf3 guinea pig neuron","Atf3 human neuron","ATF3 macaque neuron","Atf3 mouse neuron"]}];
        const DEFAULT_CELL_TYPES = [{"entity":"DRG Pvalb guinea pig (bhuiyan)","preferredLabel":"Pvalb guinea pig neuron","species":"guinea pig","circuitRole":"sensory","somaLocation":"dorsal root ganglion","somaLocations":["dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"2","nest":"","name":"Pvalb","uri":"http://www.ncbi.nlm.nih.gov/gene/100135608","expression":""}],"geneExpressionString":"Pvalb","fiberTypeString":"type A nerve fiber","fiberTypeStringAbbrev":"type A nerve fiber","physiologyString":"proprioceptive","physiologyStringAbbrev":"proprioceptive","creLine":"","color":"#FF6B6B","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":true,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":false,"species_mouse":false,"species_human":false,"species_macaque":false,"species_guinea_pig":true,"soma_drg":true,"soma_tg":false}},{"entity":"DRG Pvalb human (bhuiyan)","preferredLabel":"Pvalb human neuron","species":"human","circuitRole":"sensory","somaLocation":"dorsal root ganglion","somaLocations":["dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"2","nest":"","name":"PVALB","uri":"http://www.ncbi.nlm.nih.gov/gene/5816","expression":""}],"geneExpressionString":"PVALB","fiberTypeString":"type A nerve fiber","fiberTypeStringAbbrev":"type A nerve fiber","physiologyString":"proprioceptive","physiologyStringAbbrev":"proprioceptive","creLine":"","color":"#4ECDC4","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":true,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":false,"species_mouse":false,"species_human":true,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":false}},{"entity":"DRG Pvalb macaque (bhuiyan)","preferredLabel":"Pvalb macaque neuron","species":"macaque","circuitRole":"sensory","somaLocation":"dorsal root ganglion","somaLocations":["dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"2","nest":"","name":"PVALB","uri":"http://www.ncbi.nlm.nih.gov/gene/697272","expression":""}],"geneExpressionString":"PVALB","fiberTypeString":"type A nerve fiber","fiberTypeStringAbbrev":"type A nerve fiber","physiologyString":"proprioceptive","physiologyStringAbbrev":"proprioceptive","creLine":"","color":"#FFE5B4","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":true,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":false,"species_mouse":false,"species_human":false,"species_macaque":true,"species_guinea_pig":false,"soma_drg":true,"soma_tg":false}},{"entity":"DRG Pvalb mouse (bhuiyan)","preferredLabel":"Pvalb mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"dorsal root ganglion","somaLocations":["dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"2","nest":"","name":"Pvalb","uri":"http://www.ncbi.nlm.nih.gov/gene/19293","expression":""}],"geneExpressionString":"Pvalb","fiberTypeString":"type A nerve fiber","fiberTypeStringAbbrev":"type A nerve fiber","physiologyString":"proprioceptive","physiologyStringAbbrev":"proprioceptive","creLine":"Pvalb-Cre","color":"#C9E4CA","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":true,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":false,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":false}},{"entity":"Ntrk3^high+S100a16 guinea pig (bhuiyan)","preferredLabel":"Ntrk3^high+S100a16 guinea pig neuron","species":"guinea pig","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"Ntrk3","uri":"http://www.ncbi.nlm.nih.gov/gene/100731493 high","expression":"high"},{"union":"5","nest":"","name":"S100a16","uri":"http://www.ncbi.nlm.nih.gov/gene/100724500","expression":""}],"geneExpressionString":"Ntrk3^high + S100a16","fiberTypeString":"type Ab (beta) nerve fiber","fiberTypeStringAbbrev":"type Ab (beta) nerve fiber","physiologyString":"low-threshold mechanosensitivity (LTM) + (slowly adapting type 1 (SA1) nerve fiber OR field-type cutaneous mechanosensitivity)","physiologyStringAbbrev":"LTM + (SA1 OR FTM)","creLine":"","color":"#FCBAD3","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":true,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":true,"fiber_a_beta":true,"fiber_a_delta":false,"fiber_c":false,"species_mouse":false,"species_human":false,"species_macaque":false,"species_guinea_pig":true,"soma_drg":true,"soma_tg":true}},{"entity":"Ntrk3^high+S100a16 human (bhuiyan)","preferredLabel":"Ntrk3^high+S100a16 human neuron","species":"human","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"Ntrk3","uri":"http://www.ncbi.nlm.nih.gov/gene/4916 high","expression":"high"},{"union":"5","nest":"","name":"GRM8","uri":"http://www.ncbi.nlm.nih.gov/gene/2918","expression":""}],"geneExpressionString":"Ntrk3^high + GRM8","fiberTypeString":"type Ab (beta) nerve fiber","fiberTypeStringAbbrev":"type Ab (beta) nerve fiber","physiologyString":"low-threshold mechanosensitivity (LTM) + (slowly adapting type 1 (SA1) nerve fiber OR field-type cutaneous mechanosensitivity)","physiologyStringAbbrev":"LTM + (SA1 OR FTM)","creLine":"","color":"#A8E6CE","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":true,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":true,"fiber_a_beta":true,"fiber_a_delta":false,"fiber_c":false,"species_mouse":false,"species_human":true,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Ntrk3^high+S100a16 macaque (bhuiyan)","preferredLabel":"Ntrk3^high+S100a16 macaque neuron","species":"macaque","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"NTRK3","uri":"http://www.ncbi.nlm.nih.gov/gene/697615 high","expression":"high"},{"union":"5","nest":"","name":"S100A16","uri":"http://www.ncbi.nlm.nih.gov/gene/713638","expression":""},{"union":"5","nest":"","name":"GRM8","uri":"http://www.ncbi.nlm.nih.gov/gene/697465","expression":""}],"geneExpressionString":"NTRK3^high + (S100A16 OR GRM8)","fiberTypeString":"type Ab (beta) nerve fiber","fiberTypeStringAbbrev":"type Ab (beta) nerve fiber","physiologyString":"low-threshold mechanosensitivity (LTM) + (slowly adapting type 1 (SA1) nerve fiber OR field-type cutaneous mechanosensitivity)","physiologyStringAbbrev":"LTM + (SA1 OR FTM)","creLine":"","color":"#AA96DA","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":true,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":true,"fiber_a_beta":true,"fiber_a_delta":false,"fiber_c":false,"species_mouse":false,"species_human":false,"species_macaque":true,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Ntrk3^high+S100a16 mouse (bhuiyan)","preferredLabel":"Ntrk3^high+S100a16 mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"Ntrk3","uri":"http://www.ncbi.nlm.nih.gov/gene/18213 high","expression":"high"},{"union":"5","nest":"","name":"S100a16","uri":"http://www.ncbi.nlm.nih.gov/gene/67860","expression":""},{"union":"5","nest":"","name":"Grm8","uri":"http://www.ncbi.nlm.nih.gov/gene/14823","expression":""}],"geneExpressionString":"Ntrk3^high + (S100a16 OR Grm8)","fiberTypeString":"type Ab (beta) nerve fiber","fiberTypeStringAbbrev":"type Ab (beta) nerve fiber","physiologyString":"low-threshold mechanosensitivity (LTM) + (slowly adapting type 1 (SA1) nerve fiber OR field-type cutaneous mechanosensitivity)","physiologyStringAbbrev":"LTM + (SA1 OR FTM)","creLine":"Ntrk3tm3.1(cre/ERT2)Ddg/J","color":"#C7ECEE","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":true,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":true,"fiber_a_beta":true,"fiber_a_delta":false,"fiber_c":false,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Ntrk3^high+Ntrk2 human (bhuiyan)","preferredLabel":"Ntrk3^high+Ntrk2 human neuron","species":"human","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"NTRK3","uri":"http://www.ncbi.nlm.nih.gov/gene/4916 high","expression":"high"},{"union":"5","nest":"","name":"NTRK2","uri":"http://www.ncbi.nlm.nih.gov/gene/4915","expression":""}],"geneExpressionString":"NTRK3^high + NTRK2","fiberTypeString":"type Ab (beta) nerve fiber","fiberTypeStringAbbrev":"type Ab (beta) nerve fiber","physiologyString":"rapidly adapting (RA) nerve fiber + low-threshold mechanosensitivity (LTM)","physiologyStringAbbrev":"RA + LTM","creLine":"","color":"#FFD5C2","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":true,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":true,"slowly_adapting":false,"fiber_a_beta":true,"fiber_a_delta":false,"fiber_c":false,"species_mouse":false,"species_human":true,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Ntrk3^high+Ntrk2 macaque (bhuiyan)","preferredLabel":"Ntrk3^high+Ntrk2 macaque neuron","species":"macaque","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"NTRK3","uri":"http://www.ncbi.nlm.nih.gov/gene/697615 high","expression":"high"},{"union":"5","nest":"","name":"NTRK2","uri":"http://www.ncbi.nlm.nih.gov/gene/709757","expression":""}],"geneExpressionString":"NTRK3^high + NTRK2","fiberTypeString":"type Ab (beta) nerve fiber","fiberTypeStringAbbrev":"type Ab (beta) nerve fiber","physiologyString":"rapidly adapting (RA) nerve fiber + low-threshold mechanosensitivity (LTM)","physiologyStringAbbrev":"RA + LTM","creLine":"","color":"#FFD3B6","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":true,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":true,"slowly_adapting":false,"fiber_a_beta":true,"fiber_a_delta":false,"fiber_c":false,"species_mouse":false,"species_human":false,"species_macaque":true,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Ntrk3^high+Ntrk2 mouse (bhuiyan)","preferredLabel":"Ntrk3^high+Ntrk2 mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"Ntrk3","uri":"http://www.ncbi.nlm.nih.gov/gene/18213 high","expression":"high"},{"union":"5","nest":"","name":"Ntrk2","uri":"http://www.ncbi.nlm.nih.gov/gene/18212","expression":""},{"union":"5","nest":"","name":"Calb1","uri":"http://www.ncbi.nlm.nih.gov/gene/12307","expression":""}],"geneExpressionString":"Ntrk3^high + (Ntrk2 OR Calb1)","fiberTypeString":"type Ab (beta) nerve fiber","fiberTypeStringAbbrev":"type Ab (beta) nerve fiber","physiologyString":"rapidly adapting (RA) nerve fiber + low-threshold mechanosensitivity (LTM)","physiologyStringAbbrev":"RA + LTM","creLine":"Npy2r-GFP/Ret-CreER","color":"#E0BBE4","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":true,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":true,"slowly_adapting":false,"fiber_a_beta":true,"fiber_a_delta":false,"fiber_c":false,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Ntrk3^low+Ntrk2 guinea pig (bhuiyan)","preferredLabel":"Ntrk3^low+Ntrk2 guinea pig neuron","species":"guinea pig","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"Ntrk3","uri":"http://www.ncbi.nlm.nih.gov/gene/100731493 low","expression":"low"},{"union":"4","nest":"","name":"Ntrk2","uri":"http://www.ncbi.nlm.nih.gov/gene/100723565","expression":""}],"geneExpressionString":"Ntrk3^low + Ntrk2","fiberTypeString":"type Ad (delta) nerve fiber","fiberTypeStringAbbrev":"type Ad (delta) nerve fiber","physiologyString":"low-threshold mechanosensitivity (LTM)","physiologyStringAbbrev":"LTM","creLine":"","color":"#B5EAD7","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":true,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":true,"fiber_c":false,"species_mouse":false,"species_human":false,"species_macaque":false,"species_guinea_pig":true,"soma_drg":true,"soma_tg":true}},{"entity":"Ntrk3^low+Ntrk2 human (bhuiyan)","preferredLabel":"Ntrk3^low+Ntrk2 human neuron","species":"human","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"NTRK3","uri":"http://www.ncbi.nlm.nih.gov/gene/4916 low","expression":"low"},{"union":"4","nest":"","name":"NTRK2","uri":"http://www.ncbi.nlm.nih.gov/gene/4915","expression":""}],"geneExpressionString":"NTRK3^low + NTRK2","fiberTypeString":"type Ad (delta) nerve fiber","fiberTypeStringAbbrev":"type Ad (delta) nerve fiber","physiologyString":"low-threshold mechanosensitivity (LTM)","physiologyStringAbbrev":"LTM","creLine":"","color":"#FFDAC1","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":true,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":true,"fiber_c":false,"species_mouse":false,"species_human":true,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Ntrk3^low+Ntrk2 macaque (bhuiyan)","preferredLabel":"Ntrk3^low+Ntrk2 macaque neuron","species":"macaque","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"NTRK3","uri":"http://www.ncbi.nlm.nih.gov/gene/697615 low","expression":"low"},{"union":"4","nest":"","name":"NTRK2","uri":"http://www.ncbi.nlm.nih.gov/gene/709757","expression":""}],"geneExpressionString":"NTRK3^low + NTRK2","fiberTypeString":"type Ad (delta) nerve fiber","fiberTypeStringAbbrev":"type Ad (delta) nerve fiber","physiologyString":"low-threshold mechanosensitivity (LTM)","physiologyStringAbbrev":"LTM","creLine":"","color":"#E2F0CB","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":true,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":true,"fiber_c":false,"species_mouse":false,"species_human":false,"species_macaque":true,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Ntrk3^low+Ntrk2 mouse (bhuiyan)","preferredLabel":"Ntrk3^low+Ntrk2 mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"Ntrk3","uri":"http://www.ncbi.nlm.nih.gov/gene/18213 low","expression":"low"},{"union":"4","nest":"","name":"Ntrk2","uri":"http://www.ncbi.nlm.nih.gov/gene/18212","expression":""}],"geneExpressionString":"Ntrk3^low + Ntrk2","fiberTypeString":"type Ad (delta) nerve fiber","fiberTypeStringAbbrev":"type Ad (delta) nerve fiber","physiologyString":"low-threshold mechanosensitivity (LTM)","physiologyStringAbbrev":"LTM","creLine":"Ntrk2-CreER","color":"#C7CEEA","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":true,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":true,"fiber_c":false,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Calca+Smr2 guinea pig (bhuiyan)","preferredLabel":"Calca+Smr2 guinea pig neuron","species":"guinea pig","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"Tac1","uri":"http://www.ncbi.nlm.nih.gov/gene/100713032","expression":""},{"union":"5","nest":"","name":"Chrna7","uri":"http://www.ncbi.nlm.nih.gov/gene/100720640","expression":"(LOC100720640)"}],"geneExpressionString":"Tac1 + Chrna7^(LOC100720640)","fiberTypeString":"type Ad (delta) nerve fiber","fiberTypeStringAbbrev":"type Ad (delta) nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM) + heat-sensitive","physiologyStringAbbrev":"HTM + Heat","creLine":"","color":"#FF6B6B","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":true,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":true,"fiber_c":false,"species_mouse":false,"species_human":false,"species_macaque":false,"species_guinea_pig":true,"soma_drg":true,"soma_tg":true}},{"entity":"Calca+Smr2 human (bhuiyan)","preferredLabel":"Calca+Smr2 human neuron","species":"human","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"CALCA","uri":"http://www.ncbi.nlm.nih.gov/gene/796","expression":""},{"union":"5","nest":"","name":"CHRNA7","uri":"http://www.ncbi.nlm.nih.gov/gene/1139","expression":""}],"geneExpressionString":"CALCA + CHRNA7","fiberTypeString":"type Ad (delta) nerve fiber","fiberTypeStringAbbrev":"type Ad (delta) nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM) + heat-sensitive","physiologyStringAbbrev":"HTM + Heat","creLine":"","color":"#4ECDC4","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":true,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":true,"fiber_c":false,"species_mouse":false,"species_human":true,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Calca+Smr2 macaque (bhuiyan)","preferredLabel":"Calca+Smr2 macaque neuron","species":"macaque","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"CALCA","uri":"http://www.ncbi.nlm.nih.gov/gene/700649","expression":""},{"union":"5","nest":"","name":"CHRNA7","uri":"http://www.ncbi.nlm.nih.gov/gene/574230","expression":""}],"geneExpressionString":"CALCA + CHRNA7","fiberTypeString":"type Ad (delta) nerve fiber","fiberTypeStringAbbrev":"type Ad (delta) nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM) + heat-sensitive","physiologyStringAbbrev":"HTM + Heat","creLine":"","color":"#FFE5B4","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":true,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":true,"fiber_c":false,"species_mouse":false,"species_human":false,"species_macaque":true,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Calca+Smr2 mouse (bhuiyan)","preferredLabel":"Calca+Smr2 mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"Calca","uri":"http://www.ncbi.nlm.nih.gov/gene/12310","expression":""},{"union":"5","nest":"","name":"Smr2","uri":"http://www.ncbi.nlm.nih.gov/gene/20600","expression":""},{"union":"5","nest":"","name":"Chrna7","uri":"http://www.ncbi.nlm.nih.gov/gene/11441","expression":""}],"geneExpressionString":"Calca + (Smr2 OR Chrna7)","fiberTypeString":"type Ad (delta) nerve fiber","fiberTypeStringAbbrev":"type Ad (delta) nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM) + heat-sensitive","physiologyStringAbbrev":"HTM + Heat","creLine":"Smr2-Cre","color":"#C9E4CA","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":true,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":true,"fiber_c":false,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"DRG Calca+Bmpr1b guinea pig (bhuiyan)","preferredLabel":"Calca+Bmpr1b guinea pig neuron","species":"guinea pig","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"Tac1","uri":"http://www.ncbi.nlm.nih.gov/gene/100713032","expression":""},{"union":"4","nest":"","name":"Kit","uri":"http://www.ncbi.nlm.nih.gov/gene/100726397","expression":""}],"geneExpressionString":"Tac1 + Kit","fiberTypeString":"type Ad (delta) nerve fiber","fiberTypeStringAbbrev":"type Ad (delta) nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM)","physiologyStringAbbrev":"HTM","creLine":"","color":"#FCBAD3","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":true,"fiber_c":false,"species_mouse":false,"species_human":false,"species_macaque":false,"species_guinea_pig":true,"soma_drg":true,"soma_tg":true}},{"entity":"Calca+Bmpr1b human (bhuiyan)","preferredLabel":"Calca+Bmpr1b human neuron","species":"human","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"CALCA","uri":"http://www.ncbi.nlm.nih.gov/gene/796","expression":""},{"union":"4","nest":"","name":"KIT","uri":"http://www.ncbi.nlm.nih.gov/gene/3815","expression":""}],"geneExpressionString":"CALCA + KIT","fiberTypeString":"type Ad (delta) nerve fiber","fiberTypeStringAbbrev":"type Ad (delta) nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM)","physiologyStringAbbrev":"HTM","creLine":"","color":"#A8E6CE","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":true,"fiber_c":false,"species_mouse":false,"species_human":true,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"DRG Calca+Bmpr1b macaque (bhuiyan)","preferredLabel":"Calca+Bmpr1b macaque neuron","species":"macaque","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"CALCA","uri":"http://www.ncbi.nlm.nih.gov/gene/700649","expression":""},{"union":"4","nest":"","name":"KIT","uri":"http://www.ncbi.nlm.nih.gov/gene/696759","expression":""}],"geneExpressionString":"CALCA + KIT","fiberTypeString":"type Ad (delta) nerve fiber","fiberTypeStringAbbrev":"type Ad (delta) nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM)","physiologyStringAbbrev":"HTM","creLine":"","color":"#AA96DA","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":true,"fiber_c":false,"species_mouse":false,"species_human":false,"species_macaque":true,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Calca+Bmpr1b mouse (bhuiyan)","preferredLabel":"Calca+Bmpr1b mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"Calca","uri":"http://www.ncbi.nlm.nih.gov/gene/12310","expression":""},{"union":"4","nest":"","name":"Bmpr1b","uri":"http://www.ncbi.nlm.nih.gov/gene/12167","expression":""}],"geneExpressionString":"Calca + Bmpr1b","fiberTypeString":"type Ad (delta) nerve fiber","fiberTypeStringAbbrev":"type Ad (delta) nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM)","physiologyStringAbbrev":"HTM","creLine":"Bmpr1b-Cre","color":"#C7ECEE","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":true,"fiber_c":false,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Th guinea pig (bhuiyan)","preferredLabel":"Th guinea pig neuron","species":"guinea pig","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"Cdh9","uri":"http://www.ncbi.nlm.nih.gov/gene/100717894","expression":""}],"geneExpressionString":"Cdh9","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"low-threshold mechanosensitivity (LTM)","physiologyStringAbbrev":"LTM","creLine":"","color":"#FFD5C2","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":true,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":false,"species_human":false,"species_macaque":false,"species_guinea_pig":true,"soma_drg":true,"soma_tg":true}},{"entity":"DRG Th human (bhuiyan)","preferredLabel":"Th human neuron","species":"human","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"CDH9","uri":"http://www.ncbi.nlm.nih.gov/gene/1007","expression":""}],"geneExpressionString":"CDH9","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"low-threshold mechanosensitivity (LTM)","physiologyStringAbbrev":"LTM","creLine":"","color":"#FFD3B6","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":true,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":false,"species_human":true,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Th macaque (bhuiyan)","preferredLabel":"Th macaque neuron","species":"macaque","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"CDH9","uri":"http://www.ncbi.nlm.nih.gov/gene/694989","expression":""}],"geneExpressionString":"CDH9","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"low-threshold mechanosensitivity (LTM)","physiologyStringAbbrev":"LTM","creLine":"","color":"#E0BBE4","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":true,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":false,"species_human":false,"species_macaque":true,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"DRG Th mouse (bhuiyan)","preferredLabel":"Th mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"dorsal root ganglion","somaLocations":["dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"Th","uri":"http://www.ncbi.nlm.nih.gov/gene/21823","expression":""},{"union":"4","nest":"","name":"Cdh9","uri":"http://www.ncbi.nlm.nih.gov/gene/12565","expression":""}],"geneExpressionString":"Th + Cdh9","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"low-threshold mechanosensitivity (LTM)","physiologyStringAbbrev":"LTM","creLine":"Th-CreER","color":"#B5EAD7","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":true,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":false}},{"entity":"Mrgprd guinea pig (bhuiyan)","preferredLabel":"Mrgprd guinea pig neuron","species":"guinea pig","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"Scn11a","uri":"http://www.ncbi.nlm.nih.gov/gene/100734219","expression":""},{"union":"5","nest":"","name":"Gfra1","uri":"http://www.ncbi.nlm.nih.gov/gene/100720930","expression":""}],"geneExpressionString":"Scn11a + Gfra1","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM) + heat-sensitive","physiologyStringAbbrev":"HTM + Heat","creLine":"","color":"#FFDAC1","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":true,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":false,"species_human":false,"species_macaque":false,"species_guinea_pig":true,"soma_drg":true,"soma_tg":true}},{"entity":"Mrgprd human (bhuiyan)","preferredLabel":"Mrgprd human neuron","species":"human","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"GFRA1","uri":"http://www.ncbi.nlm.nih.gov/gene/11280","expression":""},{"union":"5","nest":"","name":"SCN11A","uri":"http://www.ncbi.nlm.nih.gov/gene/2674","expression":""}],"geneExpressionString":"GFRA1 + SCN11A","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM) + heat-sensitive","physiologyStringAbbrev":"HTM + Heat","creLine":"","color":"#E2F0CB","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":true,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":false,"species_human":true,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Mrgprd macaque (bhuiyan)","preferredLabel":"Mrgprd macaque neuron","species":"macaque","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"1","name":"SCN11A","uri":"http://www.ncbi.nlm.nih.gov/gene/695258","expression":""},{"union":"4","nest":"","name":"MRGPRD","uri":"http://www.ncbi.nlm.nih.gov/gene/709555","expression":""},{"union":"4","nest":"1","name":"GFRA1","uri":"http://www.ncbi.nlm.nih.gov/gene/706353","expression":""}],"geneExpressionString":"(MRGPRD OR (SCN11A AND GFRA1))","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM) + heat-sensitive","physiologyStringAbbrev":"HTM + Heat","creLine":"","color":"#C7CEEA","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":true,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":false,"species_human":false,"species_macaque":true,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Mrgprd mouse (bhuiyan)","preferredLabel":"Mrgprd mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"Mrgprd","uri":"http://www.ncbi.nlm.nih.gov/gene/211578","expression":""},{"union":"4","nest":"1","name":"Scn11a","uri":"http://www.ncbi.nlm.nih.gov/gene/24046","expression":""},{"union":"4","nest":"1","name":"Grfa1","uri":"http://www.ncbi.nlm.nih.gov/gene/14585","expression":""}],"geneExpressionString":"(Mrgprd OR (Scn11a AND Grfa1))","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM) + heat-sensitive","physiologyStringAbbrev":"HTM + Heat","creLine":"Mrgprd-CreER","color":"#FF6B6B","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":true,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Mrgpra3+Trpv1 mouse (bhuiyan)","preferredLabel":"Mrgpra3+Trpv1 mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"Mrgpra3","uri":"http://www.ncbi.nlm.nih.gov/gene/233222","expression":""},{"union":"5","nest":"","name":"Trpv1","uri":"http://www.ncbi.nlm.nih.gov/gene/193034","expression":""}],"geneExpressionString":"Mrgpra3 + Trpv1","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM) phenotype + heat-sensitive","physiologyStringAbbrev":"HTM + Heat","creLine":"Mrgpra3-Cre","color":"#4ECDC4","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":true,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Mrgpra3+Mrgprb4 mouse (bhuiyan)","preferredLabel":"Mrgpra3+Mrgprb4 mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"Mrgpra3","uri":"http://www.ncbi.nlm.nih.gov/gene/233222","expression":""},{"union":"5","nest":"","name":"Mrgprb4","uri":"http://www.ncbi.nlm.nih.gov/gene/233230","expression":""}],"geneExpressionString":"Mrgpra3 + Mrgprb4","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM) + heat-sensitive","physiologyStringAbbrev":"HTM + Heat","creLine":"Mrgprb4-Cre","color":"#FFE5B4","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":true,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Calca+Sstr2 human (bhuiyan)","preferredLabel":"Calca+Sstr2 human neuron","species":"human","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"CALCA","uri":"http://www.ncbi.nlm.nih.gov/gene/796","expression":""},{"union":"4","nest":"","name":"PTPRT","uri":"http://www.ncbi.nlm.nih.gov/gene/11122","expression":""}],"geneExpressionString":"CALCA + PTPRT","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"heat-sensitive","physiologyStringAbbrev":"Heat","creLine":"","color":"#C9E4CA","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":true,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":false,"species_human":true,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Calca+Sstr2 macaque (bhuiyan)","preferredLabel":"Calca+Sstr2 macaque neuron","species":"macaque","circuitRole":"Sensory Phenotype","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"CALCA","uri":"http://www.ncbi.nlm.nih.gov/gene/700649","expression":""},{"union":"4","nest":"","name":"PTPRT","uri":"http://www.ncbi.nlm.nih.gov/gene/696796","expression":""}],"geneExpressionString":"CALCA + PTPRT","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"heat-sensitive","physiologyStringAbbrev":"Heat","creLine":"","color":"#FCBAD3","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":true,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":false,"species_human":false,"species_macaque":true,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Calca+Sstr2 mouse (bhuiyan)","preferredLabel":"Calca+Sstr2 mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"Calca","uri":"http://www.ncbi.nlm.nih.gov/gene/12310","expression":""},{"union":"4","nest":"","name":"Sst","uri":"http://www.ncbi.nlm.nih.gov/gene/20606","expression":""},{"union":"4","nest":"","name":"Ptprt","uri":"http://www.ncbi.nlm.nih.gov/gene/19281","expression":""}],"geneExpressionString":"Calca + (Sst OR Ptprt)","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"heat-sensitive","physiologyStringAbbrev":"Heat","creLine":"Sstr2-CreER","color":"#A8E6CE","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":true,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Calca+Oprk1 mouse (bhuiyan)","preferredLabel":"Calca+Oprk1 mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"1","nest":"","name":"Calca","uri":"http://www.ncbi.nlm.nih.gov/gene/12310","expression":""},{"union":"2","nest":"","name":"Oprk1","uri":"http://www.ncbi.nlm.nih.gov/gene/18387","expression":""}],"geneExpressionString":"Calca + Oprk1","fiberTypeString":"","fiberTypeStringAbbrev":"","physiologyString":"","physiologyStringAbbrev":"","creLine":"Oprk1-Cre","color":"#AA96DA","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":false,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Calca+Adra2a human (bhuiyan)","preferredLabel":"Calca+Adra2a human neuron","species":"human","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"1","nest":"","name":"CALCA","uri":"http://www.ncbi.nlm.nih.gov/gene/796","expression":""},{"union":"2","nest":"","name":"ADRA2A","uri":"http://www.ncbi.nlm.nih.gov/gene/150","expression":""}],"geneExpressionString":"CALCA + ADRA2A","fiberTypeString":"","fiberTypeStringAbbrev":"","physiologyString":"","physiologyStringAbbrev":"","creLine":"","color":"#C7ECEE","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":false,"species_mouse":false,"species_human":true,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Calca+Adra2a mouse (bhuiyan)","preferredLabel":"Calca+Adra2a mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"1","nest":"","name":"Calca","uri":"http://www.ncbi.nlm.nih.gov/gene/12310","expression":""},{"union":"2","nest":"","name":"Adra2a","uri":"http://www.ncbi.nlm.nih.gov/gene/11551","expression":""}],"geneExpressionString":"Calca + Adra2a","fiberTypeString":"","fiberTypeStringAbbrev":"","physiologyString":"","physiologyStringAbbrev":"","creLine":"Adra2a-CreER","color":"#FFD5C2","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":false,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"DRG Calca+Dcn mouse (bhuiyan)","preferredLabel":"Calca+Dcn mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"dorsal root ganglion","somaLocations":["dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"1","nest":"","name":"Calca","uri":"http://www.ncbi.nlm.nih.gov/gene/12310","expression":""},{"union":"2","nest":"","name":"Dcn","uri":"http://www.ncbi.nlm.nih.gov/gene/13179","expression":""}],"geneExpressionString":"Calca + Dcn","fiberTypeString":"","fiberTypeStringAbbrev":"","physiologyString":"","physiologyStringAbbrev":"","creLine":"","color":"#FFD3B6","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":false,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":false}},{"entity":"DRG Rxfp1 macaque (bhuiyan)","preferredLabel":"Rxfp1 macaque neuron","species":"macaque","circuitRole":"sensory","somaLocation":"dorsal root ganglion","somaLocations":["dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"1","nest":"","name":"RXFP1","uri":"http://www.ncbi.nlm.nih.gov/gene/701107","expression":""}],"geneExpressionString":"RXFP1","fiberTypeString":"","fiberTypeStringAbbrev":"","physiologyString":"","physiologyStringAbbrev":"","creLine":"","color":"#E0BBE4","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":false,"species_mouse":false,"species_human":false,"species_macaque":true,"species_guinea_pig":false,"soma_drg":true,"soma_tg":false}},{"entity":"DRG Rxfp1 mouse (bhuiyan)","preferredLabel":"Rxfp1 mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"dorsal root ganglion","somaLocations":["dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"1","nest":"","name":"Rxfp1","uri":"http://www.ncbi.nlm.nih.gov/gene/381489","expression":""}],"geneExpressionString":"Rxfp1","fiberTypeString":"","fiberTypeStringAbbrev":"","physiologyString":"","physiologyStringAbbrev":"","creLine":"","color":"#B5EAD7","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":false,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":false}},{"entity":"Trpm8 guinea pig (bhuiyan)","preferredLabel":"Trpm8 guinea pig neuron","species":"guinea pig","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"Trpm8","uri":"http://www.ncbi.nlm.nih.gov/gene/100337634","expression":""}],"geneExpressionString":"Trpm8","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"cold-sensitive","physiologyStringAbbrev":"Cold","creLine":"","color":"#FFDAC1","clusterAttributes":{"cold_sensitive":true,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":false,"species_human":false,"species_macaque":false,"species_guinea_pig":true,"soma_drg":true,"soma_tg":true}},{"entity":"Trpm8 human (bhuiyan)","preferredLabel":"Trpm8 human neuron","species":"human","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"TRPM8","uri":"http://www.ncbi.nlm.nih.gov/gene/79054","expression":""}],"geneExpressionString":"TRPM8","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"cold-sensitive","physiologyStringAbbrev":"Cold","creLine":"","color":"#E2F0CB","clusterAttributes":{"cold_sensitive":true,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":false,"species_human":true,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Trpm8 macaque (bhuiyan)","preferredLabel":"Trpm8 macaque neuron","species":"macaque","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"TRPM8","uri":"http://www.ncbi.nlm.nih.gov/gene/100429414","expression":""}],"geneExpressionString":"TRPM8","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"cold-sensitive","physiologyStringAbbrev":"Cold","creLine":"","color":"#C7CEEA","clusterAttributes":{"cold_sensitive":true,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":false,"species_human":false,"species_macaque":true,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Trpm8 mouse (bhuiyan)","preferredLabel":"Trpm8 mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"3","nest":"","name":"Trpm8","uri":"http://www.ncbi.nlm.nih.gov/gene/171382","expression":""}],"geneExpressionString":"Trpm8","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"cold-sensitive","physiologyStringAbbrev":"Cold","creLine":"Trpm8-Cre/Trpm8-Flpo","color":"#FF6B6B","clusterAttributes":{"cold_sensitive":true,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Sst guinea pig (bhuiyan)","preferredLabel":"Sst guinea pig neuron","species":"guinea pig","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"Sst","uri":"http://www.ncbi.nlm.nih.gov/gene/100730851","expression":""}],"geneExpressionString":"Sst","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM) + heat-sensitive","physiologyStringAbbrev":"HTM + Heat","creLine":"","color":"#4ECDC4","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":true,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":false,"species_human":false,"species_macaque":false,"species_guinea_pig":true,"soma_drg":true,"soma_tg":true}},{"entity":"Sst human (bhuiyan)","preferredLabel":"Sst human neuron","species":"human","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"SST","uri":"http://www.ncbi.nlm.nih.gov/gene/6750","expression":""}],"geneExpressionString":"SST","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM) + heat-sensitive","physiologyStringAbbrev":"HTM + Heat","creLine":"","color":"#FFE5B4","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":true,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":false,"species_human":true,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Sst macaque (bhuiyan)","preferredLabel":"Sst macaque neuron","species":"macaque","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"SST","uri":"http://www.ncbi.nlm.nih.gov/gene/708626","expression":""}],"geneExpressionString":"SST","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM) + heat-sensitive","physiologyStringAbbrev":"HTM + Heat","creLine":"","color":"#C9E4CA","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":true,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":false,"species_human":false,"species_macaque":true,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Sst mouse (bhuiyan)","preferredLabel":"Sst mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"trigeminal ganglion","somaLocations":["trigeminal ganglion","dorsal root ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"4","nest":"","name":"Sst","uri":"http://www.ncbi.nlm.nih.gov/gene/20604","expression":""}],"geneExpressionString":"Sst","fiberTypeString":"type C nerve fiber","fiberTypeStringAbbrev":"type C nerve fiber","physiologyString":"high-threshold mechanosensitivity (HTM) phenotype + heat-sensitive","physiologyStringAbbrev":"HTM + Heat","creLine":"Cysltr2-Cre/Sst-Cre","color":"#FCBAD3","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":true,"mechanosensitive_ltm":false,"mechanosensitive_htm":true,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":true,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Atf3 guinea pig (bhuiyan)","preferredLabel":"Atf3 guinea pig neuron","species":"guinea pig","circuitRole":"sensory","somaLocation":"dorsal root ganglion","somaLocations":["dorsal root ganglion","trigeminal ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"1","nest":"","name":"Atf3","uri":"http://www.ncbi.nlm.nih.gov/gene/100722370","expression":""}],"geneExpressionString":"Atf3","fiberTypeString":"","fiberTypeStringAbbrev":"","physiologyString":"","physiologyStringAbbrev":"","creLine":"","color":"#A8E6CE","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":false,"species_mouse":false,"species_human":false,"species_macaque":false,"species_guinea_pig":true,"soma_drg":true,"soma_tg":true}},{"entity":"ATF3 human (bhuiyan)","preferredLabel":"Atf3 human neuron","species":"human","circuitRole":"sensory","somaLocation":"dorsal root ganglion","somaLocations":["dorsal root ganglion","trigeminal ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"1","nest":"","name":"ATF3","uri":"http://www.ncbi.nlm.nih.gov/gene/467","expression":""}],"geneExpressionString":"ATF3","fiberTypeString":"","fiberTypeStringAbbrev":"","physiologyString":"","physiologyStringAbbrev":"","creLine":"","color":"#AA96DA","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":false,"species_mouse":false,"species_human":true,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Atf3 macaque (bhuiyan)","preferredLabel":"ATF3 macaque neuron","species":"macaque","circuitRole":"sensory","somaLocation":"dorsal root ganglion","somaLocations":["dorsal root ganglion","trigeminal ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"1","nest":"","name":"ATF3","uri":"http://www.ncbi.nlm.nih.gov/gene/710832","expression":""}],"geneExpressionString":"ATF3","fiberTypeString":"","fiberTypeStringAbbrev":"","physiologyString":"","physiologyStringAbbrev":"","creLine":"","color":"#C7ECEE","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":false,"species_mouse":false,"species_human":false,"species_macaque":true,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}},{"entity":"Atf3 mouse (bhuiyan)","preferredLabel":"Atf3 mouse neuron","species":"mouse","circuitRole":"sensory","somaLocation":"dorsal root ganglion","somaLocations":["dorsal root ganglion","trigeminal ganglion"],"sourceNomenclature":"https://doi.org/10.1126/sciadv.adj9173","sourceNomenclatureLabel":"","markerGenes":[{"union":"1","nest":"","name":"Atf3","uri":"http://www.ncbi.nlm.nih.gov/gene/11910","expression":""}],"geneExpressionString":"Atf3","fiberTypeString":"","fiberTypeStringAbbrev":"","physiologyString":"","physiologyStringAbbrev":"","creLine":"Atf3-CreER","color":"#FFD5C2","clusterAttributes":{"cold_sensitive":false,"heat_sensitive":false,"mechanosensitive_ltm":false,"mechanosensitive_htm":false,"proprioceptive":false,"rapidly_adapting":false,"slowly_adapting":false,"fiber_a_beta":false,"fiber_a_delta":false,"fiber_c":false,"species_mouse":true,"species_human":false,"species_macaque":false,"species_guinea_pig":false,"soma_drg":true,"soma_tg":true}}];
        
        let CELL_TYPES = JSON.parse(JSON.stringify(DEFAULT_CELL_TYPES));
        let FAMILIES = JSON.parse(JSON.stringify(DEFAULT_FAMILIES));
        let currentView = 'cards';
        let selectedAttributes = [];
        let clusterSimulation = null;
        let clusterNodes = [];
        let clusterCenters = {};
        let nodeRadius = 14;
        let enclosureTimer = null;
        
        const ATTR_LABELS = { cold_sensitive:'Cold', heat_sensitive:'Heat', mechanosensitive_ltm:'LTM', mechanosensitive_htm:'HTM', proprioceptive:'Proprioceptive', rapidly_adapting:'RA', slowly_adapting:'SA', fiber_a_beta:'AŒ≤', fiber_a_delta:'AŒ¥', fiber_c:'C', species_mouse:'Mouse', species_human:'Human', species_macaque:'Macaque', species_guinea_pig:'Guinea Pig', soma_drg:'DRG', soma_tg:'Trigeminal' };
        const ATTR_SHORT = { cold_sensitive:'Cold', heat_sensitive:'Heat', mechanosensitive_ltm:'LTM', mechanosensitive_htm:'HTM', proprioceptive:'Proprio', rapidly_adapting:'RA', slowly_adapting:'SA', fiber_a_beta:'AŒ≤', fiber_a_delta:'AŒ¥', fiber_c:'C', species_mouse:'Mouse', species_human:'Human', species_macaque:'Macaque', species_guinea_pig:'G.Pig', soma_drg:'DRG', soma_tg:'TG' };
        const ATTR_COLORS = [{ solid:'#667eea' }, { solid:'#f5576c' }, { solid:'#22c55e' }];
        
        function formatGeneExpression(t) { return t ? t.replace(/(\w+)\^(\w+)/g, '$1<sup>$2</sup>') : ''; }
        function formatFiberType(s) { return s ? s.replace(/type Ad/g,'type AŒ¥').replace(/type Ab/g,'type AŒ≤').replace(/Ad \(/g,'AŒ¥ (').replace(/Ab \(/g,'AŒ≤ (').replace(/\(delta\)/g,'(Œ¥)').replace(/\(beta\)/g,'(Œ≤)') : ''; }
        
        function buildExpressionWithNesting(items, useAbbrev = false) {
            if (!items || !items.length) return '';
            const unionGroups = {};
            items.forEach(item => { const u = item.union; if (!unionGroups[u]) unionGroups[u] = []; unionGroups[u].push(item); });
            const unionParts = [];
            Object.keys(unionGroups).sort((a,b) => (parseInt(a)||999) - (parseInt(b)||999)).forEach(unionKey => {
                const unionItems = unionGroups[unionKey];
                const noNest = unionItems.filter(i => i.nest === null || i.nest === undefined || i.nest === '');
                const nested = {};
                unionItems.forEach(i => { if (i.nest !== null && i.nest !== undefined && i.nest !== '') { if (!nested[i.nest]) nested[i.nest] = []; nested[i.nest].push(i); }});
                const orParts = [];
                noNest.forEach(item => { orParts.push(useAbbrev ? item.abbrev : item.display); });
                Object.keys(nested).sort().forEach(nestKey => {
                    const nestItems = nested[nestKey];
                    if (nestItems.length > 1) {
                        const andParts = nestItems.map(i => useAbbrev ? i.abbrev : i.display);
                        orParts.push('(' + andParts.join(' AND ') + ')');
                    } else {
                        orParts.push(useAbbrev ? nestItems[0].abbrev : nestItems[0].display);
                    }
                });
                if (orParts.length > 1) unionParts.push('(' + orParts.join(' OR ') + ')');
                else if (orParts.length === 1) unionParts.push(orParts[0]);
            });
            return unionParts.join(' + ');
        }
        
        function getSourceLinkText(ct) {
            return ct.sourceNomenclatureLabel || 'View Source Publication';
        }
        
        function showUploadModal() { document.getElementById('uploadModal').classList.add('show'); }
        function closeUploadModal() { document.getElementById('uploadModal').classList.remove('show'); }
        function handleFileSelect(e) { const f = e.target.files[0]; if (f) processFile(f); }
        
        function processFile(file) {
            const ext = file.name.split('.').pop().toLowerCase();
            if (ext === 'csv') { Papa.parse(file, { header: true, complete: r => loadDataFromRows(r.data, file.name), error: e => alert('Error: ' + e.message) }); }
            else if (ext === 'xlsx' || ext === 'xls') { const reader = new FileReader(); reader.onload = e => { const wb = XLSX.read(e.target.result, {type:'binary'}); loadDataFromRows(XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]), file.name); }; reader.readAsBinaryString(file); }
            else alert('Unsupported format');
        }
        
        function loadDataFromRows(rows, filename) {
            const cols = Object.keys(rows[0] || {});
            if (!cols.some(c => c.toLowerCase().includes('neuron id') || c.toLowerCase().includes('npo property'))) { alert('Please use NPO Template format'); return; }
            CELL_TYPES = parseNPOFormat(rows);
            if (CELL_TYPES.length === 0) { alert('No valid cell types found.'); return; }
            generateFamilies();
            const ds = document.getElementById('dataStatus'); if(ds) { ds.textContent = `${filename} (${CELL_TYPES.length} cells)`; ds.classList.add('loaded'); }
            const st = document.getElementById('statTotal'); if(st) st.textContent = CELL_TYPES.length;
            closeUploadModal();
            selectedAttributes = []; clusterSimulation = null;
            renderCards(); if (currentView === 'tree') renderTreeView(); if (currentView === 'cluster') initClusterView();
        }
        
        function parseNPOFormat(rows) {
            const neurons = {};
            const firstRow = rows[0] || {};
            const colMap = {};
            Object.keys(firstRow).forEach(k => {
                const kl = k.toLowerCase();
                if (kl.includes('neuron id')) colMap.neuronId = k;
                else if (kl.includes('npo property') && !kl.includes('value')) colMap.npo = k;
                else if (kl.includes('union set')) colMap.union = k;
                else if (kl.includes('nest intersection')) colMap.nest = k;
                else if (kl.includes('property value label')) colMap.value = k;
                else if (kl.includes('property value iri') || kl.includes('npo property value iri')) colMap.iri = k;
            });
            
            rows.forEach(row => {
                const nid = row[colMap.neuronId];
                if (!nid || nid.toLowerCase().includes('master')) return;
                if (!neurons[nid]) neurons[nid] = [];
                const valRaw = row[colMap.value];
                const iriRaw = row[colMap.iri];
                neurons[nid].push({
                    npo: row[colMap.npo] || '',
                    union: row[colMap.union],
                    nest: row[colMap.nest],
                    value: (valRaw && String(valRaw).toLowerCase() !== 'none') ? String(valRaw).trim() : '',
                    iri: (iriRaw && String(iriRaw).toLowerCase() !== 'none') ? String(iriRaw).trim() : ''
                });
            });
            
            const colors = ['#FF6B6B','#4ECDC4','#FFE5B4','#C9E4CA','#FCBAD3','#A8E6CE','#AA96DA','#C7ECEE','#FFD5C2','#FFD3B6','#E0BBE4'];
            const cellTypes = [];
            
            Object.entries(neurons).forEach(([nid, props], idx) => {
                const ct = { entity:'', preferredLabel:'', species:'unknown', circuitRole:'sensory', somaLocation:'', somaLocations:[], sourceNomenclature:'', sourceNomenclatureLabel:'', markerGenes:[], geneExpressionString:'', fiberTypeString:'', fiberTypeStringAbbrev:'', physiologyString:'', physiologyStringAbbrev:'', creLine:'', color: colors[idx % colors.length], clusterAttributes: { cold_sensitive:false, heat_sensitive:false, mechanosensitive_ltm:false, mechanosensitive_htm:false, proprioceptive:false, rapidly_adapting:false, slowly_adapting:false, fiber_a_beta:false, fiber_a_delta:false, fiber_c:false, species_mouse:false, species_human:false, species_macaque:false, species_guinea_pig:false, soma_drg:false, soma_tg:false } };
                const geneItems=[], thresholdItems=[], adaptItems=[], functionalItems=[], axonItems=[];
                
                props.forEach(p => {
                    const npo=p.npo, val=p.value, iri=p.iri, union=p.union, nest=p.nest;
                    if (npo==='rdfs:label') ct.entity=val;
                    else if (npo==='skos:prefLabel') ct.preferredLabel=val;
                    else if (npo==='ilxtr:hasInstanceInTaxon') { ct.species=val.toLowerCase(); const k=`species_${val.toLowerCase().replace(' ','_')}`; if(ct.clusterAttributes.hasOwnProperty(k)) ct.clusterAttributes[k]=true; }
                    else if (npo==='ilxtr:hasCircuitRolePhenotype') ct.circuitRole=val;
                    else if (npo==='ilxtr:hasSomaLocatedIn' && val && !ct.somaLocations.includes(val)) { ct.somaLocations.push(val); if(val.toLowerCase().includes('dorsal root')) ct.clusterAttributes.soma_drg=true; if(val.toLowerCase().includes('trigeminal')) ct.clusterAttributes.soma_tg=true; }
                    else if (npo==='ilxtr:literatureCitation') { ct.sourceNomenclature = iri || ''; ct.sourceNomenclatureLabel = val || ''; }
                    else if (npo==='ilxtr:hasDriverExpressionConstitutivePhenotype') ct.creLine=val;
                    else if (npo==='ilxtr:hasExpressionPhenotype' && val) { const ps=val.split(' '), nm=ps[0], exp=ps[1]||''; geneItems.push({union,nest,value:nm,display:exp?`${nm}^${exp}`:nm,expression:exp}); ct.markerGenes.push({union:String(union||''),nest:String(nest||''),name:nm,uri:iri||'',expression:exp}); }
                    else if (npo==='ilxtr:hasAxonPhenotype' && val) { axonItems.push({union,nest,value:val,display:val}); const vl=val.toLowerCase(); if(vl.includes('beta')||vl.includes('(beta)')) ct.clusterAttributes.fiber_a_beta=true; if(vl.includes('delta')||vl.includes('(delta)')) ct.clusterAttributes.fiber_a_delta=true; if(vl.includes('type c')) ct.clusterAttributes.fiber_c=true; }
                    else if (npo==='ilxtr:hasThresholdPhenotype' && val) { thresholdItems.push({union,nest,value:val,display:val}); const vl=val.toLowerCase(); if(vl.includes('ltm')||vl.includes('low-threshold')) ct.clusterAttributes.mechanosensitive_ltm=true; if(vl.includes('htm')||vl.includes('high-threshold')) ct.clusterAttributes.mechanosensitive_htm=true; }
                    else if (npo==='ilxtr:hasAdaptationPhenotype' && val) { adaptItems.push({union,nest,value:val,display:val}); const vl=val.toLowerCase(); if(vl.includes('rapidly')||vl.includes('(ra)')) ct.clusterAttributes.rapidly_adapting=true; if(vl.includes('slowly')||vl.includes('sa1')) ct.clusterAttributes.slowly_adapting=true; }
                    else if (npo==='ilxtr:hasFunctionalPhenotype' && val) { functionalItems.push({union,nest,value:val,display:val}); const vl=val.toLowerCase(); if(vl.includes('cold')) ct.clusterAttributes.cold_sensitive=true; if(vl.includes('heat')) ct.clusterAttributes.heat_sensitive=true; if(vl.includes('proprioceptive')) ct.clusterAttributes.proprioceptive=true; }
                });
                
                ct.geneExpressionString = buildExpressionWithNesting(geneItems);
                ct.fiberTypeString = buildExpressionWithNesting(axonItems);
                ct.fiberTypeStringAbbrev = ct.fiberTypeString;
                
                const allPhys = [...thresholdItems, ...adaptItems, ...functionalItems];
                if (allPhys.length) {
                    ct.physiologyString = buildExpressionWithNesting(allPhys);
                    const am = {'cold-sensitive':'Cold','heat-sensitive':'Heat','low-threshold mechanosensitivity (ltm)':'LTM','high-threshold mechanosensitivity (htm)':'HTM','proprioceptive':'proprioceptive','rapidly adapting (ra) nerve fiber':'RA','slowly adapting type 1 (sa1) nerve fiber':'SA1','field-type cutaneous mechanosensitivity':'FTM'};
                    allPhys.forEach(p => { const vl=p.value.toLowerCase().trim(); let ab=null; for(const[f,s]of Object.entries(am)){if(vl.includes(f)){ab=s;break;}} if(!ab){if(vl.includes('ltm')||vl.includes('low-threshold'))ab='LTM';else if(vl.includes('htm')||vl.includes('high-threshold'))ab='HTM';else if(vl.includes('cold'))ab='Cold';else if(vl.includes('heat'))ab='Heat';else if(vl.includes('proprioceptive'))ab='proprioceptive';else if(vl.includes('rapidly'))ab='RA';else if(vl.includes('slowly')||vl.includes('sa1'))ab='SA1';else if(vl.includes('field-type'))ab='FTM';else ab=p.value;} p.abbrev=ab; });
                    ct.physiologyStringAbbrev = buildExpressionWithNesting(allPhys, true);
                }
                if(ct.somaLocations.length) ct.somaLocation=ct.somaLocations[0];
                if(ct.preferredLabel) cellTypes.push(ct);
            });
            return cellTypes;
        }
        
        function generateFamilies() { const fm={}; CELL_TYPES.forEach(ct=>{let fn=ct.preferredLabel;['mouse','human','macaque','guinea pig','rat'].forEach(sp=>{fn=fn.replace(new RegExp(` ${sp} neuron$`,'i'),'').replace(new RegExp(` ${sp}$`,'i'),'');});fn=fn.trim();const fk=fn.toLowerCase();if(!fm[fk])fm[fk]={name:fn,children:[]};fm[fk].children.push(ct.preferredLabel);}); FAMILIES=Object.entries(fm).map(([k,d],i)=>({id:String(i+1),name:d.name,children:d.children})); }
        function loadDefaultData() { CELL_TYPES=JSON.parse(JSON.stringify(DEFAULT_CELL_TYPES)); FAMILIES=JSON.parse(JSON.stringify(DEFAULT_FAMILIES)); const ds=document.getElementById('dataStatus'); if(ds){ds.textContent=`Default data (${CELL_TYPES.length} cells)`;ds.classList.remove('loaded');} const st=document.getElementById('statTotal'); if(st)st.textContent=CELL_TYPES.length; closeUploadModal(); selectedAttributes=[]; clusterSimulation=null; renderCards(); if(currentView==='tree')renderTreeView(); if(currentView==='cluster')initClusterView(); }
        function switchView(view) { currentView=view; document.querySelectorAll('.view-btn').forEach(btn=>btn.classList.toggle('active',btn.dataset.view===view)); document.getElementById('cardViewContainer').style.display=view==='cards'?'block':'none'; document.getElementById('treeViewContainer').style.display=view==='tree'?'block':'none'; document.getElementById('clusterViewContainer').style.display=view==='cluster'?'block':'none'; if(view==='tree')renderTreeView(); if(view==='cluster')initClusterView(); }
        
        function renderCards() { 
            const c=document.getElementById('cardsContainer'); 
            c.innerHTML=CELL_TYPES.map((ct,idx)=>`<div class="card" onclick="showModal(${idx})"><div class="card-header"><div class="card-title">${ct.preferredLabel}</div>${ct.sourceNomenclature?`<a href="${ct.sourceNomenclature}" target="_blank" class="card-source-link" onclick="event.stopPropagation()">üìÑ Source</a>`:''}</div><div class="card-body"><div class="card-entity">${ct.entity}</div><div style="margin-bottom:0.75rem;color:#718096;"><strong>Species:</strong> ${ct.species}${ct.somaLocations&&ct.somaLocations.length?`<br><strong>Location:</strong> ${ct.somaLocations.join(', ')}`:''}</div>${ct.fiberTypeString?`<div class="card-section"><div class="section-title">üî¨ Axon Phenotype</div><div class="gene-display">${formatFiberType(formatGeneExpression(ct.fiberTypeStringAbbrev))}</div></div>`:''}${ct.geneExpressionString?`<div class="card-section"><div class="section-title">üß¨ Marker Genes</div><div class="gene-display">${formatGeneExpression(ct.geneExpressionString)}</div></div>`:''}${ct.physiologyStringAbbrev?`<div class="card-section"><div class="section-title">‚ö° Physiology</div><div class="gene-display">${formatGeneExpression(ct.physiologyStringAbbrev)}</div></div>`:''}</div></div>`).join(''); 
        }
        
        function renderTreeView() { const c=document.getElementById('treeView'); const sg={}; CELL_TYPES.forEach(ct=>{(ct.somaLocations||[ct.somaLocation||'Unknown']).forEach(soma=>{if(!sg[soma])sg[soma]=[];if(!sg[soma].find(x=>x.preferredLabel===ct.preferredLabel))sg[soma].push(ct);});}); const li={'dorsal root ganglion':'üîµ','trigeminal ganglion':'üü¢'}; let html='',si=0; Object.entries(sg).forEach(([soma,cells])=>{ const fm={}; cells.forEach(ct=>{let fn=ct.preferredLabel;['mouse','human','macaque','guinea pig','rat'].forEach(sp=>{fn=fn.replace(new RegExp(` ${sp} neuron$`,'i'),'').replace(new RegExp(` ${sp}$`,'i'),'');});fn=fn.trim();const fk=fn.toLowerCase();if(!fm[fk])fm[fk]={name:fn,children:[]};fm[fk].children.push(ct.preferredLabel);}); const fams=Object.values(fm);const icon=li[soma.toLowerCase()]||'üìç'; html+=`<div class="tree-soma-group"><div class="tree-soma-header" onclick="toggleSomaGroup(${si})"><span class="tree-soma-toggle" id="soma-toggle-${si}">‚ñ∂</span><span class="tree-soma-icon">${icon}</span><span class="tree-soma-name">${soma}</span><span class="tree-soma-count">${fams.length} families ‚Ä¢ ${cells.length} cells</span></div><div class="tree-soma-children" id="soma-children-${si}">`; fams.forEach((fam,fi)=>{const uid=`${si}-${fi}`;html+=`<div class="tree-item"><div class="tree-master" onclick="toggleFamily('${uid}')"><span class="tree-toggle" id="toggle-${uid}">‚ñ∂</span><div style="display:inline-block;vertical-align:top;"><div class="tree-master-name">${formatGeneExpression(fam.name)}</div><div class="tree-master-count">${fam.children.length} variants</div></div></div><div class="tree-children" id="children-${uid}">${fam.children.map(ch=>{const ct=CELL_TYPES.find(x=>x.preferredLabel===ch);return`<div class="tree-child" onclick="showModalByName('${ch.replace(/'/g,"\\'")}')"><div class="tree-child-name">${ch}</div>${ct?`<div class="tree-child-species">üß¨ ${ct.geneExpressionString?formatGeneExpression(ct.geneExpressionString):'No marker genes'}</div>`:''}</div>`;}).join('')}</div></div>`;}); html+=`</div></div>`;si++; }); c.innerHTML=html; }
        function toggleSomaGroup(i){document.getElementById(`soma-children-${i}`).classList.toggle('expanded');document.getElementById(`soma-toggle-${i}`).classList.toggle('expanded');}
        function toggleFamily(id){document.getElementById(`children-${id}`).classList.toggle('expanded');document.getElementById(`toggle-${id}`).classList.toggle('expanded');}
        
        function initClusterView() { const svg=d3.select('#clusterSvg'); const container=document.querySelector('.cluster-viz-area'); if(!container||container.clientWidth===0||container.clientHeight===0){setTimeout(initClusterView,50);return;} const width=container.clientWidth,height=container.clientHeight; nodeRadius=Math.max(8,Math.min(14,Math.min(width,height)/60)); svg.attr('width',width).attr('height',height); svg.selectAll('*').remove(); svg.append('g').attr('class','enclosures'); svg.append('g').attr('class','nodes'); svg.append('g').attr('class','labels'); clusterNodes=CELL_TYPES.map((ct,i)=>({...ct,id:i,x:width/2+(Math.random()-0.5)*200,y:height/2+(Math.random()-0.5)*200,radius:nodeRadius})); clusterSimulation=d3.forceSimulation(clusterNodes).force('charge',d3.forceManyBody().strength(-40)).force('center',d3.forceCenter(width/2,height/2)).force('collision',d3.forceCollide().radius(d=>d.radius+2)).on('tick',clusterTicked).on('end', drawClusterEnclosures); updateClusterVisualization(); }
        
        function handleAttrClick(btn) { if(!clusterSimulation||!clusterNodes.length){initClusterView();setTimeout(()=>handleAttrClick(btn),100);return;} const attr=btn.dataset.attr;const idx=selectedAttributes.indexOf(attr); if(idx>=0){selectedAttributes.splice(idx,1);btn.classList.remove('active','attr-2','attr-3');} else if(selectedAttributes.length<3){selectedAttributes.push(attr);btn.classList.add('active');} document.querySelectorAll('.attr-btn').forEach(b=>{b.classList.remove('attr-2','attr-3');const ai=selectedAttributes.indexOf(b.dataset.attr);if(ai===1)b.classList.add('attr-2');if(ai===2)b.classList.add('attr-3');}); updateClusterLegend();updateClusterStats();updateClusterVisualization(); }
        function getClusterKey(ct){if(selectedAttributes.length===0)return'all';return selectedAttributes.map(a=>ct.clusterAttributes[a]?'1':'0').join('');}
        function getClusterLabel(key){if(key==='all')return'All Cells';const parts=[];for(let i=0;i<key.length;i++){if(key[i]==='1')parts.push(ATTR_SHORT[selectedAttributes[i]]);}return parts.length===0?'None':parts.join(' + ');}
        function getNodeColor(ct){if(selectedAttributes.length===0)return ct.color||'#667eea';const matches=selectedAttributes.map(a=>ct.clusterAttributes[a]);const mc=matches.filter(Boolean).length;if(mc===0)return'#555';if(mc===selectedAttributes.length&&selectedAttributes.length>=2)return'#ffffff';const mi=matches.map((m,i)=>m?i:-1).filter(i=>i>=0);if(mi.length===1)return ATTR_COLORS[mi[0]].solid;return'#c4b5fd';}
        function getClusterColor(key){if(key==='all')return'#667eea';const mc=key.split('').filter(c=>c==='1').length;if(mc===0)return'#555';if(mc===selectedAttributes.length&&selectedAttributes.length>=2)return'#ffffff';const mi=[];for(let i=0;i<key.length;i++){if(key[i]==='1')mi.push(i);}if(mi.length===1)return ATTR_COLORS[mi[0]].solid;return'#c4b5fd';}
        function calculateClusterCenters(w,h){clusterCenters={};if(selectedAttributes.length===0){clusterCenters['all']={x:w/2,y:h/2};return;} const mx=w*0.12,my=h*0.1,uw=w-mx*2,uh=h-my*2,cx=w/2,cy=h/2; if(selectedAttributes.length===1){clusterCenters['1']={x:cx,y:my+uh*0.3};clusterCenters['0']={x:mx+uw*0.85,y:cy};} else if(selectedAttributes.length===2){clusterCenters['11']={x:cx,y:my+uh*0.2};clusterCenters['10']={x:mx+uw*0.15,y:cy};clusterCenters['01']={x:cx,y:my+uh*0.7};clusterCenters['00']={x:mx+uw*0.9,y:cy};} else if(selectedAttributes.length===3){clusterCenters['111']={x:cx,y:my+uh*0.12};clusterCenters['110']={x:mx+uw*0.2,y:my+uh*0.35};clusterCenters['101']={x:mx+uw*0.5,y:my+uh*0.35};clusterCenters['011']={x:mx+uw*0.35,y:my+uh*0.58};clusterCenters['100']={x:mx+uw*0.1,y:my+uh*0.75};clusterCenters['010']={x:mx+uw*0.35,y:my+uh*0.88};clusterCenters['001']={x:mx+uw*0.6,y:my+uh*0.75};clusterCenters['000']={x:mx+uw*0.92,y:cy};}}
        
        function updateClusterVisualization(){
            const svg=d3.select('#clusterSvg');
            const container=document.querySelector('.cluster-viz-area');
            const width=container.clientWidth,height=container.clientHeight;
            nodeRadius=Math.max(8,Math.min(14,Math.min(width,height)/60));
            clusterNodes.forEach(n=>n.radius=nodeRadius);
            calculateClusterCenters(width,height);
            
            // Clear any pending enclosure redraw
            if (enclosureTimer) { clearTimeout(enclosureTimer); enclosureTimer = null; }
            
            if(selectedAttributes.length>0){
                clusterSimulation
                    .force('x',d3.forceX(d=>clusterCenters[getClusterKey(d)]?.x||width/2).strength(0.7))
                    .force('y',d3.forceY(d=>clusterCenters[getClusterKey(d)]?.y||height/2).strength(0.7))
                    .force('charge',d3.forceManyBody().strength(-30))
                    .force('collision',d3.forceCollide().radius(d=>d.radius+1));
            } else {
                clusterSimulation
                    .force('x',d3.forceX(width/2).strength(0.05))
                    .force('y',d3.forceY(height/2).strength(0.05))
                    .force('charge',d3.forceManyBody().strength(-60))
                    .force('collision',d3.forceCollide().radius(d=>d.radius+3));
            }
            
            clusterSimulation.alpha(0.8).restart();
            
            const ns=svg.select('.nodes').selectAll('.cluster-node').data(clusterNodes,d=>d.id);
            const ne=ns.enter().append('circle').attr('class','cluster-node').attr('r',d=>d.radius)
                .call(d3.drag().on('start',dragStarted).on('drag',dragged).on('end',dragEnded))
                .on('mouseover',showClusterTooltip).on('mousemove',moveClusterTooltip).on('mouseout',hideClusterTooltip)
                .on('click',(e,d)=>showModal(d.id));
            ns.merge(ne).transition().duration(300)
                .attr('fill',d=>getNodeColor(d))
                .attr('stroke',d=>{
                    if(selectedAttributes.length===0)return'rgba(255,255,255,0.3)';
                    const mc=selectedAttributes.map(a=>d.clusterAttributes[a]).filter(Boolean).length;
                    if(mc===selectedAttributes.length&&selectedAttributes.length>=2)return'#667eea';
                    return mc>0?'rgba(255,255,255,0.4)':'rgba(255,255,255,0.15)';
                })
                .attr('stroke-width',2);
            
            // Schedule enclosure redraw after simulation settles
            scheduleEnclosureRedraw();
        }
        
        function scheduleEnclosureRedraw() {
            if (enclosureTimer) clearTimeout(enclosureTimer);
            // Redraw enclosures multiple times as simulation settles
            enclosureTimer = setTimeout(() => {
                drawClusterEnclosures();
                // Redraw again after more settling
                enclosureTimer = setTimeout(() => {
                    drawClusterEnclosures();
                    // Final redraw
                    enclosureTimer = setTimeout(drawClusterEnclosures, 800);
                }, 600);
            }, 400);
        }
        
        function drawClusterEnclosures(){
            const svg=d3.select('#clusterSvg');
            svg.select('.enclosures').selectAll('*').remove();
            svg.select('.labels').selectAll('*').remove();
            if(selectedAttributes.length===0)return;
            const clusters={};
            clusterNodes.forEach(n=>{const k=getClusterKey(n);if(!clusters[k])clusters[k]=[];clusters[k].push(n);});
            Object.entries(clusters).forEach(([key,nodes])=>{
                if(nodes.length===0)return;
                const pad=nodeRadius*1.8;
                const minX=d3.min(nodes,d=>d.x)-pad,maxX=d3.max(nodes,d=>d.x)+pad;
                const minY=d3.min(nodes,d=>d.y)-pad,maxY=d3.max(nodes,d=>d.y)+pad;
                const cx=(minX+maxX)/2,cy=(minY+maxY)/2;
                const rx=Math.max((maxX-minX)/2,nodeRadius*2.5);
                const ry=Math.max((maxY-minY)/2,nodeRadius*2.5);
                const color=getClusterColor(key),label=getClusterLabel(key);
                svg.select('.enclosures').append('ellipse').attr('class','cluster-enclosure')
                    .attr('cx',cx).attr('cy',cy).attr('rx',rx+5).attr('ry',ry+5).attr('stroke',color);
                const lt=`${label} (${nodes.length})`,ly=minY-6,tw=lt.length*6+12;
                svg.select('.labels').append('rect').attr('class','cluster-label-bg')
                    .attr('x',cx-tw/2).attr('y',ly-10).attr('width',tw).attr('height',16);
                svg.select('.labels').append('text').attr('class','cluster-label')
                    .attr('x',cx).attr('y',ly+2).attr('fill',color).text(lt);
            });
        }
        
        function clusterTicked(){
            d3.select('#clusterSvg').select('.nodes').selectAll('.cluster-node').attr('cx',d=>d.x).attr('cy',d=>d.y);
        }
        function dragStarted(e,d){if(!e.active)clusterSimulation.alphaTarget(0.3).restart();d.fx=d.x;d.fy=d.y;}
        function dragged(e,d){d.fx=e.x;d.fy=e.y;}
        function dragEnded(e,d){if(!e.active)clusterSimulation.alphaTarget(0);d.fx=null;d.fy=null;scheduleEnclosureRedraw();}
        
        function showClusterTooltip(e,d){const tt=document.getElementById('clusterTooltip');tt.innerHTML=`<div class="cluster-tooltip-title">${d.preferredLabel}</div><div class="cluster-tooltip-row"><strong>Species:</strong> ${d.species}</div><div class="cluster-tooltip-row"><strong>Location:</strong> ${(d.somaLocations||[d.somaLocation]).join(', ')}</div>${d.physiologyStringAbbrev?`<div class="cluster-tooltip-row"><strong>Physiology:</strong> ${d.physiologyStringAbbrev}</div>`:''}${d.fiberTypeStringAbbrev?`<div class="cluster-tooltip-row"><strong>Axon:</strong> ${formatFiberType(d.fiberTypeStringAbbrev)}</div>`:''}`;tt.classList.add('visible');}
        function moveClusterTooltip(e){const tt=document.getElementById('clusterTooltip');const r=document.querySelector('.cluster-viz-area').getBoundingClientRect();tt.style.left=(e.clientX-r.left+15)+'px';tt.style.top=(e.clientY-r.top+15)+'px';}
        function hideClusterTooltip(){document.getElementById('clusterTooltip').classList.remove('visible');}
        function updateClusterLegend(){const lg=document.getElementById('clusterLegendInline');if(selectedAttributes.length===0){lg.innerHTML='<div class="legend-item-inline"><div class="legend-dot" style="background:#667eea;"></div><span>Select attributes to cluster</span></div>';return;}let html='';if(selectedAttributes.length===1){html+=`<div class="legend-item-inline"><div class="legend-dot" style="background:${ATTR_COLORS[0].solid};"></div><span>${ATTR_LABELS[selectedAttributes[0]]}</span></div>`;html+='<div class="legend-item-inline"><div class="legend-dot" style="background:#555;"></div><span>None</span></div>';}else{selectedAttributes.forEach((a,i)=>{html+=`<div class="legend-item-inline"><div class="legend-dot" style="background:${ATTR_COLORS[i].solid};"></div><span>${ATTR_SHORT[a]} only</span></div>`;});html+='<div class="legend-item-inline"><div class="legend-dot" style="background:#fff;border:2px solid #667eea;"></div><span>All</span></div>';html+='<div class="legend-item-inline"><div class="legend-dot" style="background:#555;"></div><span>None</span></div>';}lg.innerHTML=html;}
        function updateClusterStats(){const st=document.getElementById('clusterStatsInline');let html=`<div class="stat-item"><span class="stat-label">Total:</span><span class="stat-value">${CELL_TYPES.length}</span></div>`;if(selectedAttributes.length>0){selectedAttributes.forEach((a,i)=>{const c=CELL_TYPES.filter(ct=>ct.clusterAttributes[a]).length;html+=`<div class="stat-item"><span class="stat-label">${ATTR_SHORT[a]}:</span><span class="stat-value" style="color:${ATTR_COLORS[i].solid};">${c}</span></div>`;});if(selectedAttributes.length>=2){const ic=CELL_TYPES.filter(ct=>selectedAttributes.every(a=>ct.clusterAttributes[a])).length;html+=`<div class="stat-item"><span class="stat-label">All:</span><span class="stat-value" style="color:#2d3748;">${ic}</span></div>`;}}st.innerHTML=html;}
        
        function showModal(idx){
            const ct=CELL_TYPES[idx];
            document.getElementById('modalTitle').textContent=ct.preferredLabel;
            const sourceLinkHtml = ct.sourceNomenclature ? 
                `<div class="detail-section"><h3>üìö Source Publication</h3><a href="${ct.sourceNomenclature}" target="_blank" class="source-link">${getSourceLinkText(ct)} ‚Üó</a></div>` : '';
            document.getElementById('modalBody').innerHTML=`
                <div class="detail-section">
                    <p><strong>Entity:</strong> ${ct.entity}</p>
                    <p><strong>Species:</strong> ${ct.species}</p>
                    <p><strong>Soma Location:</strong> ${(ct.somaLocations||[ct.somaLocation]).join(', ')}</p>
                    <p><strong>Circuit Role:</strong> ${ct.circuitRole}</p>
                    ${ct.creLine?`<p><strong>Cre Line:</strong> ${ct.creLine}</p>`:''}
                </div>
                ${ct.geneExpressionString?`<div class="detail-section"><h3>üß¨ Marker Gene Expression</h3><div style="padding:1.5rem;background:linear-gradient(135deg,#667eea20,#764ba220);border:3px solid #667eea;border-radius:12px;font-size:1.25rem;font-weight:700;color:#2d3748;line-height:1.8;margin-bottom:1.5rem;">${formatGeneExpression(ct.geneExpressionString)}</div>${ct.markerGenes&&ct.markerGenes.length?`<h4 style="font-size:0.9rem;color:#718096;margin-bottom:0.75rem;">Individual Gene References:</h4><div class="gene-grid">${ct.markerGenes.map(g=>`<a href="${g.uri}" target="_blank" class="gene-link">${g.name}${g.expression?`<sup>${g.expression}</sup>`:''} ‚Üó</a>`).join('')}</div>`:''}</div>`:''}
                ${ct.fiberTypeString?`<div class="detail-section"><h3>üî¨ Axon Phenotype</h3><div style="padding:1rem;background:#f7fafc;border-radius:10px;font-size:1rem;font-weight:600;color:#2d3748;line-height:1.6;border:2px solid #e2e8f0;">${formatFiberType(formatGeneExpression(ct.fiberTypeString))}</div></div>`:''}
                ${ct.physiologyString?`<div class="detail-section"><h3>‚ö° Physiology (Threshold + Adaptation)</h3><div style="padding:1.5rem;background:linear-gradient(135deg,#48bb7820,#38a16920);border:3px solid #48bb78;border-radius:12px;font-size:1.25rem;font-weight:700;color:#2d3748;line-height:1.8;">${formatGeneExpression(ct.physiologyString)}</div></div>`:''}
                ${sourceLinkHtml}
            `;
            document.getElementById('modal').classList.add('show');
        }
        
        function showModalByName(name){const idx=CELL_TYPES.findIndex(ct=>ct.preferredLabel===name);if(idx!==-1)showModal(idx);}
        function closeModal(){document.getElementById('modal').classList.remove('show');}
        
        document.addEventListener('DOMContentLoaded', () => {
            renderCards();
            document.querySelectorAll('.view-btn').forEach(btn=>{btn.addEventListener('click',()=>switchView(btn.dataset.view));});
            document.getElementById('modal').addEventListener('click',(e)=>{if(e.target.id==='modal')closeModal();});
            document.getElementById('uploadModal').addEventListener('click',(e)=>{if(e.target.id==='uploadModal')closeUploadModal();});
            document.querySelectorAll('.attr-btn').forEach(btn=>{btn.addEventListener('click',()=>handleAttrClick(btn));});
            const dropZone = document.getElementById('dropZone');
            if (dropZone) { dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); }); dropZone.addEventListener('dragleave', () => { dropZone.classList.remove('dragover'); }); dropZone.addEventListener('drop', e => { e.preventDefault(); dropZone.classList.remove('dragover'); if (e.dataTransfer.files[0]) processFile(e.dataTransfer.files[0]); }); }
        });
        window.addEventListener('resize',()=>{if(currentView==='cluster'&&clusterSimulation){const container=document.querySelector('.cluster-viz-area');const w=container.clientWidth,h=container.clientHeight;nodeRadius=Math.max(8,Math.min(14,Math.min(w,h)/60));clusterNodes.forEach(n=>n.radius=nodeRadius);d3.select('#clusterSvg').attr('width',w).attr('height',h);calculateClusterCenters(w,h);clusterSimulation.force('center',d3.forceCenter(w/2,h/2));clusterSimulation.alpha(0.5).restart();scheduleEnclosureRedraw();}});
    </script>
</body>
</html>
